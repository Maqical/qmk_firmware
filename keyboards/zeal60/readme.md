Code taken from https://github.com/Wilba6582
All I did was update it to work with current build of qmk.
